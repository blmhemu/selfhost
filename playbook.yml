---

- name: Ready nodes
  hosts: all
  roles:
    - role: role-ntp
      become: true
    - blmhemu.general.bootparams
    - blmhemu.general.bootstrap
    - role: role-tailscale
    - role-docker

# NFS server and client
- name: Ready NFS Server
  hosts: nas0
  pre_tasks:
    - include_tasks: tasks/btrfs.yml
  roles:
    - role: robertdebock.roles.nfsserver
      become: true

- name: Mount nfs on nomad clients
  hosts: nomad_clients:!nas0
  roles:
    - role: robertdebock.roles.autofs
      become: true

- name: Ready consul cluster
  hosts: consul_instances
  pre_tasks:
    - include_tasks: tasks/tls_consul.yml
  roles:
    - blmhemu.general.consul

- name: Ready nomad cluster
  hosts: nomad_instances
  pre_tasks:
    - include_tasks: tasks/tls_nomad.yml
  roles:
    - blmhemu.general.nomad
